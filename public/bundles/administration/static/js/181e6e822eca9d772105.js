(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[13921],{601820:function(){},613921:function(e,n,o){"use strict";o.r(n),o.d(n,{default:function(){return a}}),o(307669);var i=o(791889);let{Mixin:t}=Shopware,{Criteria:s}=Shopware.Data,l="extension.plugin_upload";var a={template:'{% block sw_extension_file_upload %}\n<div class="sw-extension-file-upload">\n    {% block sw_extension_file_upload_content %}\n    <div class="sw-extension-file-upload__content">\n        {% block sw_extension_file_upload_button %}\n        <sw-button\n            class="sw-extension-file-upload__button"\n            :is-loading="isLoading"\n            variant="primary"\n            @click="showConfirmModal"\n        >\n            {{ $tc(\'sw-extension.my-extensions.fileUpload.buttonFileUpload\') }}\n        </sw-button>\n        {% endblock %}\n        {% block sw_extension_file_upload_form %}\n        <form\n            ref="fileForm"\n            class="sw-extension-file-upload__form"\n        >\n            \n            <input\n                id="files"\n                ref="fileInput"\n                class="sw-extension-file-upload__file-input"\n                type="file"\n                @change="onFileInputChange"\n            >\n        </form>\n        {% endblock %}\n    </div>\n    {% endblock %}\n\n    {% block sw_extension_file_upload_confirm_modal %}\n    <sw-modal\n        v-if="confirmModalVisible"\n        class="sw-extension-file-upload-confirm-modal"\n        :title="$tc(\'sw-extension.my-extensions.fileUpload.titleWarningModal\')"\n        variant="small"\n        @modal-close="closeConfirmModal"\n    >\n        {% block sw_extension_file_upload_confirm_modal_content %}\n        <template #default>\n            {% block sw_extension_file_upload_confirm_modal_body %}\n            <p>\n                {{ $tc(\'sw-extension.my-extensions.fileUpload.descriptionWarningModal\') }}\n            </p>\n            {% endblock %}\n        </template>\n        <template #modal-footer>\n            {% block sw_extension_file_upload_confirm_modal_footer %}\n            {% block sw_extension_file_upload_confirm_modal_footer_checkbox %}\n            <sw-checkbox-field\n                v-model:value="shouldHideConfirmModal"\n            >\n                {% block sw_extension_file_upload_confirm_modal_footer_checkbox_label %}\n                <template #label>\n                    {{ $tc(\'sw-extension.my-extensions.fileUpload.textHideWarning\') }}\n                </template>\n                {% endblock %}\n            </sw-checkbox-field>\n            {% endblock %}\n\n            {% block sw_extension_file_upload_confirm_modal_footer_buttons %}\n            <div>\n                {% block sw_extension_file_upload_confirm_modal_footer_cancel %}\n                <sw-button\n                    size="small"\n                    :disabled="isLoading"\n                    @click="closeConfirmModal"\n                >\n                    {{ $tc(\'global.default.cancel\') }}\n                </sw-button>\n                {% endblock %}\n\n                {% block sw_extension_file_upload_confirm_modal_footer_continue %}\n                <sw-button\n                    variant="primary"\n                    size="small"\n                    :is-loading="isLoading"\n                    @click="onClickUpload"\n                >\n                    {{ $tc(\'global.default.confirm\') }}\n                </sw-button>\n                {% endblock %}\n            </div>\n            {% endblock %}\n            {% endblock %}\n        </template>\n        {% endblock %}\n    </sw-modal>\n    {% endblock %}\n</div>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["extensionStoreActionService","repositoryFactory"],mixins:[t.getByName("notification")],data(){return{isLoading:!0,confirmModalVisible:!1,shouldHideConfirmModal:!1,pluginUploadUserConfig:null}},computed:{userConfigRepository(){return this.repositoryFactory.create("user_config")},currentUser(){return Shopware.State.get("session").currentUser},userConfigCriteria(){let e=new s(1,25);return e.addFilter(s.equals("key",l)),e.addFilter(s.equals("userId",this.currentUser?.id)),e}},created(){this.createdComponent()},methods:{async createdComponent(){await this.getUserConfig(),this.isLoading=!1},onClickUpload(){this.$refs.fileInput.click()},onFileInputChange(){let e=Array.from(this.$refs.fileInput.files);this.handleUpload(e),this.$refs.fileForm.reset()},handleUpload(e){this.isLoading=!0;let n=new FormData;return n.append("file",e[0]),this.extensionStoreActionService.upload(n).then(()=>{Shopware.Service("shopwareExtensionService").updateExtensionData().then(()=>this.createNotificationSuccess({message:this.$tc("sw-extension.my-extensions.fileUpload.messageUploadSuccess")}))}).catch(e=>{i.A.mapErrors(e.response.data.errors).forEach(e=>{if(e.parameters){this.showStoreError(e);return}let n=[this.$tc(e.message),e.details].filter(Boolean).join("<br />");this.createNotificationError({message:n})})}).finally(()=>{this.isLoading=!1,this.confirmModalVisible=!1,!0===this.shouldHideConfirmModal&&this.saveConfig(!0)})},showStoreError(e){let n=this.$tc("sw-extension.errors.messageToTheShopwareDocumentation",0,e.parameters);this.createNotificationError({message:`${e.message} ${n}`,autoClose:!1})},showConfirmModal(){if(!0===this.pluginUploadUserConfig.value.hide_upload_warning){this.onClickUpload();return}this.confirmModalVisible=!0},closeConfirmModal(){this.confirmModalVisible=!1},getUserConfig(){return this.userConfigRepository.search(this.userConfigCriteria,Shopware.Context.api).then(e=>{e.length?this.pluginUploadUserConfig=e.first():(this.pluginUploadUserConfig=this.userConfigRepository.create(Shopware.Context.api),this.pluginUploadUserConfig.key=l,this.pluginUploadUserConfig.userId=this.currentUser?.id,this.pluginUploadUserConfig.value={hide_upload_warning:!1})})},saveConfig(e){this.pluginUploadUserConfig.value={hide_upload_warning:e},this.userConfigRepository.save(this.pluginUploadUserConfig,Shopware.Context.api).then(()=>{this.getUserConfig()})}}}},307669:function(e,n,o){var i=o(601820);i.__esModule&&(i=i.default),"string"==typeof i&&(i=[[e.id,i,""]]),i.locals&&(e.exports=i.locals),(0,o(370534).A)("6b1cdffc",i,!0,{})}}]);