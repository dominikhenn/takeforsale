(window.webpackJsonpAdministration=window.webpackJsonpAdministration||[]).push([[81561],{875016:function(){},481561:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return i}}),n(499957);let{Criteria:r}=Shopware.Data;var i={template:'{% block sw_product_clone_modal %}\n<sw-modal\n    v-if="cloningVariants"\n    :title="$tc(\'sw-product.general.cloneTitle\')"\n    :closable="false"\n    variant="small"\n    class="clone-variant__modal"\n>\n    {% block sw_product_clone_modal_description %}\n    <div class="clone-variant__description">\n        {{ $tc(\'sw-product.general.cloneNotice\') }}\n    </div>\n    {% endblock %}\n\n    {% block sw_product_clone_modal_progress_bar %}\n    <sw-progress-bar\n        class="clone-variant-progress-bar"\n        :value="progressInPercentage"\n    />\n    {% endblock %}\n\n    {% block sw_product_clone_modal_progress_bar_description %}\n    <div class="clone-variant-progress-bar__description">\n        {{ cloneProgress }} {{ $tc(\'sw-product.variations.progressTypeOf\') }} {{ cloneMaxProgress }} {{ $tc(\'sw-product.general.cloneSuffix\') }}\n    </div>\n    {% endblock %}\n</sw-modal>\n{% endblock %}\n',compatConfig:Shopware.compatConfig,inject:["repositoryFactory","numberRangeService"],emits:["clone-finish"],props:{product:{type:Object,required:!0}},data(){return{cloningVariants:!1,cloneMaxProgress:0,cloneProgress:0}},computed:{progressInPercentage(){return 100/(this.cloneMaxProgress*this.cloneProgress)},repository(){return this.repositoryFactory.create("product")}},created(){this.createdComponent()},methods:{createdComponent(){this.duplicate()},duplicate(){this.numberRangeService.reserve("product").then(this.cloneParent).then(this.verifyVariants)},async cloneParent(e){let t=this.product.variantListingConfig;t&&t.mainVariantId&&(t.mainVariantId=null);let n={cloneChildren:!1,overwrites:{productNumber:e.number,name:`${this.product.name} ${this.$tc("global.default.copy")}`,active:!1,mainVariantId:null,variantListingConfig:t}};return await this.repository.save(this.product),{id:(await this.repository.clone(this.product.id,n,Shopware.Context.api)).id,productNumber:e.number}},verifyVariants(e){this.getChildrenIds().then(t=>{if(t.length<=0){this.$emit("clone-finish",{id:e.id});return}this.cloningVariants=!0,this.cloneProgress=1,this.cloneMaxProgress=t.length,this.duplicateVariant(e,t,()=>{this.cloningVariants=!1,this.$emit("clone-finish",{id:e.id})})})},getChildrenIds(){let e=new r(1,null);return e.addFilter(r.equals("parentId",this.product.id)),this.repository.searchIds(e).then(e=>e.data)},duplicateVariant(e,t,n){if(t.length<=0){n();return}let r=t.shift(),i={overwrites:{parentId:e.id,productNumber:`${e.productNumber}.${this.cloneProgress}`},cloneChildren:!1};this.repository.clone(r,i,Shopware.Context.api).then(()=>{this.cloneProgress+=1,this.duplicateVariant(e,t,n)})}}}},499957:function(e,t,n){var r=n(875016);r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.id,r,""]]),r.locals&&(e.exports=r.locals),(0,n(370534).A)("303c4ab2",r,!0,{})}}]);